(()=>{"use strict";var t={d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};t.d({},{X:()=>T});var e="#FC9B45",r="#51A6FF",n="#FFFFFF",a=50,o=50,i=30,l="".concat(i,"px Arial"),c="動";function s(t){return e=this,r=void 0,a=function(){return function(t,e){var r,n,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(c){return function(l){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(i=0)),i;)try{if(r=1,n&&(a=2&l[0]?n.return:l[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,l[1])).done)return a;switch(n=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,n=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){i.label=l[1];break}if(6===l[0]&&i.label<a[1]){i.label=a[1],a=l;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(l);break}a[2]&&i.ops.pop(),i.trys.pop();continue}l=e.call(t,i)}catch(t){l=[6,t],n=0}finally{r=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,c])}}}(this,(function(e){return[2,new Promise((function(e){return setTimeout(e,t)}))]}))},new((n=void 0)||(n=Promise))((function(t,o){function i(t){try{c(a.next(t))}catch(t){o(t)}}function l(t){try{c(a.throw(t))}catch(t){o(t)}}function c(e){var r;e.done?t(e.value):(r=e.value,r instanceof n?r:new n((function(t){t(r)}))).then(i,l)}c((a=a.apply(e,r||[])).next())}));var e,r,n,a}function u(t){T.clearRect(t.x,t.y,t.w,t.h)}function h(t){t.cardInfo.PartOfSpeech==c?T.fillStyle=r:T.fillStyle=e;var l=a*t.cardInfo.Word.length;T.fillRect(t.rect.x,t.rect.y,l,o),T.fillStyle=n,T.fillText(t.cardInfo.Word,t.rect.x+.5*(l-i*t.cardInfo.Word.length),t.rect.y+35)}function f(t,e,r){T.beginPath(),T.rect(t.x,t.y,t.w,t.h),T.lineWidth=r,T.strokeStyle=e,T.stroke()}var y=function(){function t(){this.cardArray=[],this.inventoryTailX=110,this.inventoryTailY=350,this.rect={x:100,y:340,w:600,h:220}}return t.prototype.drawInventory=function(){var t;u(this.rect),t=this.rect,T.fillStyle="#BEBEBE",T.fillRect(t.x,t.y,t.w,t.h);for(var e=0;e<this.cardArray.length;e++)this.cardArray[e].isSelected||h(this.cardArray[e])},t.prototype.addCard=function(t){var e=a*t.Word.length;this.inventoryTailX+10+e>600&&(this.inventoryTailY+=10+o),this.cardArray.push({rect:{x:this.inventoryTailX,y:this.inventoryTailY,w:e,h:o},inventoryX:this.inventoryTailX,inventoryY:this.inventoryTailY,cardInfo:t,isSelected:!1}),this.inventoryTailX=this.inventoryTailX+e+10},t}(),d=function(){function t(t){this.verticalInterval=5,this.rect=t}return t.prototype.say=function(t){return e=this,r=void 0,o=function(){var e,r,a,o;return function(t,e){var r,n,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(c){return function(l){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(i=0)),i;)try{if(r=1,n&&(a=2&l[0]?n.return:l[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,l[1])).done)return a;switch(n=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,n=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){i.label=l[1];break}if(6===l[0]&&i.label<a[1]){i.label=a[1],a=l;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(l);break}a[2]&&i.ops.pop(),i.trys.pop();continue}l=e.call(t,i)}catch(t){l=[6,t],n=0}finally{r=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,c])}}}(this,(function(c){switch(c.label){case 0:u(this.rect),T.font=l,e=function(t,e){for(var r=[],n=0;n<t.length;n+=20)r.push(t.substring(n,n+20));return r}(t),r=0,c.label=1;case 1:if(!(r<e.length))return[3,6];a=e[r],o=1,c.label=2;case 2:return o<=a.length?(T.fillStyle=n,T.fillText(a.substring(0,o),this.rect.x,this.rect.y+i+(i+this.verticalInterval)*r),[4,s(40)]):[3,5];case 3:c.sent(),c.label=4;case 4:return o++,[3,2];case 5:return r++,[3,1];case 6:return[2]}}))},new((a=void 0)||(a=Promise))((function(t,n){function i(t){try{c(o.next(t))}catch(t){n(t)}}function l(t){try{c(o.throw(t))}catch(t){n(t)}}function c(e){var r;e.done?t(e.value):(r=e.value,r instanceof a?r:new a((function(t){t(r)}))).then(i,l)}c((o=o.apply(e,r||[])).next())}));var e,r,a,o},t}(),p=function(){function t(t,e,r){this.lineWidth=6,this.rect=t,this.partOfSpeech=e,this.card=r}return t.prototype.drawSlot=function(){u(this.rect),this.partOfSpeech==c?f(this.rect,r,this.lineWidth):f(this.rect,e,this.lineWidth),this.card&&function(t,a,l){t.cardInfo.PartOfSpeech==c?T.fillStyle=r:T.fillStyle=e;var s=50*t.cardInfo.Word.length,u=a-.5*s,h=l-.5*o;T.fillRect(u,h,s,o),T.fillStyle=n,T.fillText(t.cardInfo.Word,u+.5*(s-i*t.cardInfo.Word.length),h+35)}(this.card,this.rect.x+.5*this.rect.w,this.rect.y+.5*this.rect.h)},t.prototype.InsertCard=function(t){this.card=t,t.isSelected=!0,t.rect.x=this.rect.x+.5*(this.rect.w-t.rect.w),t.rect.y=this.rect.y},t.prototype.RemoveCard=function(){this.card=null},t.prototype.IsCardEqual=function(t){return this.card==t},t.prototype.GetCardID=function(){return this.card?this.card.cardInfo.ID:-1},t}();const v=JSON.parse('[{"ID":0,"Word":"我","PartOfSpeech":"名"},{"ID":1,"Word":"檢視","PartOfSpeech":"動"},{"ID":2,"Word":"密室","PartOfSpeech":"名"},{"ID":3,"Word":"桌子","PartOfSpeech":"名"},{"ID":4,"Word":"門","PartOfSpeech":"名"},{"ID":5,"Word":"移至","PartOfSpeech":"動"},{"ID":6,"Word":"開","PartOfSpeech":"動"}]'),b=JSON.parse('[{"ID":0,"Dialogue":"這裡是哪裡？「我」醒了過來。發現在自己被困在一間「密室」。我摸著自己的口袋，沒有找到手機，無法對外聯繫。但發現一張詞卡「檢視」。這是做什麼用的？（獲得「密室」、「我」、「檢視」）"},{"ID":1,"Dialogue":"我檢視這密室。看見密室內有一扇「門」與一張「桌子」。沒有別的東西了。"},{"ID":2,"Dialogue":"我已經檢視過這密室。密室內除了一扇門與一張桌子外，沒有其他特別的東西了。"}]'),w=JSON.parse('[{"CardID1":0,"CardID2":1,"CardID3":2,"StatusID":0,"NewCardID":[3,4],"DialogueID":1},{"CardID1":0,"CardID2":1,"CardID3":2,"StatusID":1,"DialogueID":2}]');var I,g,D=function(t,e,r,n){return new(r||(r=Promise))((function(a,o){function i(t){try{c(n.next(t))}catch(t){o(t)}}function l(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(i,l)}c((n=n.apply(t,e||[])).next())}))},S=function(t,e){var r,n,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(c){return function(l){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(i=0)),i;)try{if(r=1,n&&(a=2&l[0]?n.return:l[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,l[1])).done)return a;switch(n=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,n=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){i.label=l[1];break}if(6===l[0]&&i.label<a[1]){i.label=a[1],a=l;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(l);break}a[2]&&i.ops.pop(),i.trys.pop();continue}l=e.call(t,i)}catch(t){l=[6,t],n=0}finally{r=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,c])}}},C=function(){function t(){var t=this;this.cardTable=new Map,this.dialogueTable=new Map,this.inventory=new y,this.slotArray=[new p({x:145,y:270,w:150,h:50},"名",null),new p({x:325,y:270,w:150,h:50},c,null),new p({x:505,y:270,w:150,h:50},"名",null)],this.typeWriter=new d({x:100,y:70,w:600,h:190}),v.forEach((function(e){t.cardTable.set(e.ID,e)})),this.sentenceTable=w,b.forEach((function(e){t.dialogueTable.set(e.ID,e.Dialogue)})),this.levelState={alreadyInspectRoom:!1,alreadyInspectDoor:!1,alreadyInspectTable:!1,alreadyGotOpen:!1,alreadyOpenDoor:!1,alreadyOpenTable:!1,alreadyOpenCornerCeiling:!1,alreadyOpenDoorCeiling:!1,alreadyEnterCeiling:!1,tablePosition:I.Room,mePosition:g.Room}}return t.prototype.begin=function(){this.entrySequence()},t.prototype.entrySequence=function(){return D(this,void 0,void 0,(function(){var t;return S(this,(function(e){switch(e.label){case 0:for(t=0;t<this.slotArray.length;t++)this.slotArray[t].drawSlot();return this.inventory.drawInventory(),[4,this.typeWriter.say(this.dialogueTable.get(0))];case 1:return e.sent(),this.inventory.addCard(this.cardTable.get(2)),this.inventory.addCard(this.cardTable.get(0)),this.inventory.addCard(this.cardTable.get(1)),this.inventory.drawInventory(),[2]}}))}))},t.prototype.onCanvasClick=function(t){var e=this;this.inventory.cardArray.forEach((function(r){if(n=t,a=r.rect,n.x>a.x&&n.x<a.x+a.w&&n.y<a.y+a.h&&n.y>a.y){var n,a;if(r.isSelected){r.rect.x=r.inventoryX,r.rect.y=r.inventoryY,r.isSelected=!1;for(var o=0;o<e.slotArray.length;o++)if(e.slotArray[o].IsCardEqual(r)){e.slotArray[o].RemoveCard(),e.slotArray[o].drawSlot(),e.inventory.drawInventory();break}}else for(o=0;o<e.slotArray.length;o++){var i=e.slotArray[o];if(i.partOfSpeech==r.cardInfo.PartOfSpeech&&i.IsCardEqual(null)){i.InsertCard(r),i.drawSlot(),e.inventory.drawInventory();break}}for(o=0;o<e.sentenceTable.length;o++){var l=e.sentenceTable[o];if(l.CardID1==e.slotArray[0].GetCardID()&&l.CardID2==e.slotArray[1].GetCardID()&&l.CardID3==e.slotArray[2].GetCardID()&&l.StatusID==+e.levelState.alreadyInspectRoom){e.SayDialogue(l),e.levelState.alreadyInspectRoom=!0;break}}}}))},t.prototype.SayDialogue=function(t){return D(this,void 0,void 0,(function(){var e;return S(this,(function(r){switch(r.label){case 0:return[4,this.typeWriter.say(this.dialogueTable.get(t.DialogueID))];case 1:if(r.sent(),t.NewCardID){for(e=0;e<t.NewCardID.length;e++)this.inventory.addCard(this.cardTable.get(t.NewCardID[e]));this.inventory.drawInventory()}return[2]}}))}))},t}();!function(t){t[t.Room=0]="Room",t[t.Door=1]="Door",t[t.Corner=2]="Corner"}(I||(I={})),function(t){t[t.Room=0]="Room",t[t.OnTable=1]="OnTable"}(g||(g={}));var x=document.getElementById("mainCanvas"),T=x.getContext("2d"),m=new C;x.addEventListener("click",(function(t){var e=function(t,e){var r=t.getBoundingClientRect();return{x:e.clientX-r.left,y:e.clientY-r.top}}(x,t);m.onCanvasClick(e)})),m.begin()})();
//# sourceMappingURL=main.js.map