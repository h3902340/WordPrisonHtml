(()=>{"use strict";var t={d:(e,i)=>{for(var o in i)t.o(i,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:i[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};t.d({},{X:()=>m});var e="#FC9B45",i="#51A6FF",o="#FFFFFF";function n(t){return e=this,i=void 0,n=function(){return function(t,e){var i,o,n,r,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:D(0),throw:D(1),return:D(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function D(D){return function(d){return function(D){if(i)throw new TypeError("Generator is already executing.");for(;r&&(r=0,D[0]&&(a=0)),a;)try{if(i=1,o&&(n=2&D[0]?o.return:D[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,D[1])).done)return n;switch(o=0,n&&(D=[2&D[0],n.value]),D[0]){case 0:case 1:n=D;break;case 4:return a.label++,{value:D[1],done:!1};case 5:a.label++,o=D[1],D=[0];continue;case 7:D=a.ops.pop(),a.trys.pop();continue;default:if(!((n=(n=a.trys).length>0&&n[n.length-1])||6!==D[0]&&2!==D[0])){a=0;continue}if(3===D[0]&&(!n||D[1]>n[0]&&D[1]<n[3])){a.label=D[1];break}if(6===D[0]&&a.label<n[1]){a.label=n[1],n=D;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(D);break}n[2]&&a.ops.pop(),a.trys.pop();continue}D=e.call(t,a)}catch(t){D=[6,t],o=0}finally{i=n=0}if(5&D[0])throw D[1];return{value:D[0]?D[1]:void 0,done:!0}}([D,d])}}}(this,(function(e){return[2,new Promise((function(e){return setTimeout(e,t)}))]}))},new((o=void 0)||(o=Promise))((function(t,r){function a(t){try{d(n.next(t))}catch(t){r(t)}}function D(t){try{d(n.throw(t))}catch(t){r(t)}}function d(e){var i;e.done?t(e.value):(i=e.value,i instanceof o?i:new o((function(t){t(i)}))).then(a,D)}d((n=n.apply(e,i||[])).next())}));var e,i,o,n}function r(t){m.clearRect(t.x,t.y,t.w,t.h)}function a(t,e){m.fillStyle=e,m.fillRect(t.x,t.y,t.w,t.h)}function D(t,e,i){m.beginPath(),m.rect(t.x,t.y,t.w,t.h),m.lineWidth=i,m.strokeStyle=e,m.stroke()}function d(t,e,i,o,n){m.font="".concat(n,"px ").concat(o),m.fillStyle=i,m.fillText(t,e.x,e.y)}function l(t,e){return t.x>e.x&&t.x<e.x+e.w&&t.y<e.y+e.h&&t.y>e.y}var I=function(){function t(t,e){this.cardArray=[],this.rect=t,this.padding=e,this.currentTail={x:t.x+e,y:t.y+e}}return t.prototype.CheckIfHit=function(t){return l(t,this.rect)},t.prototype.CheckIfHitCard=function(t){for(var e=0;e<this.cardArray.length;e++)if(!this.cardArray[e].isRemoved&&l(t,this.cardArray[e].card.GetRect()))return this.cardArray[e].card;return null},t.prototype.drawInventory=function(){r(this.rect),a(this.rect,"#BEBEBE");for(var t=0;t<this.cardArray.length;t++)this.cardArray[t].isRemoved||this.cardArray[t].card.drawCard()},t.prototype.AddCard=function(t){for(var e=0;e<this.cardArray.length;e++)if(this.cardArray[e].card==t)return this.cardArray[e].isRemoved=!1,void this.cardArray[e].card.PlaceAt(this.cardArray[e].originalPos);this.currentTail.x+this.padding+t.GetRect().w>this.rect.x+this.rect.w&&(this.currentTail.y+=this.padding+70,this.currentTail.x=this.rect.x+this.padding);var i={x:this.currentTail.x,y:this.currentTail.y};this.cardArray.push({card:t,originalPos:i,isRemoved:!1}),t.PlaceAt(i),this.currentTail.x+=t.GetRect().w+this.padding},t.prototype.RemoveCard=function(t){for(var e=0;e<this.cardArray.length;e++)if(this.cardArray[e].card==t)return this.cardArray[e].isRemoved=!0,t;return null},t}(),s=function(){function t(t,e){this.rect=t,this.lineInterval=e,this.lineWordCount=Math.floor(t.w/30),this.startPosition={x:t.x+.5*(t.w-30*this.lineWordCount),y:t.y+30}}return t.prototype.say=function(t){return e=this,i=void 0,D=function(){var e,i,a,D;return function(t,e){var i,o,n,r,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:D(0),throw:D(1),return:D(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function D(D){return function(d){return function(D){if(i)throw new TypeError("Generator is already executing.");for(;r&&(r=0,D[0]&&(a=0)),a;)try{if(i=1,o&&(n=2&D[0]?o.return:D[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,D[1])).done)return n;switch(o=0,n&&(D=[2&D[0],n.value]),D[0]){case 0:case 1:n=D;break;case 4:return a.label++,{value:D[1],done:!1};case 5:a.label++,o=D[1],D=[0];continue;case 7:D=a.ops.pop(),a.trys.pop();continue;default:if(!((n=(n=a.trys).length>0&&n[n.length-1])||6!==D[0]&&2!==D[0])){a=0;continue}if(3===D[0]&&(!n||D[1]>n[0]&&D[1]<n[3])){a.label=D[1];break}if(6===D[0]&&a.label<n[1]){a.label=n[1],n=D;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(D);break}n[2]&&a.ops.pop(),a.trys.pop();continue}D=e.call(t,a)}catch(t){D=[6,t],o=0}finally{i=n=0}if(5&D[0])throw D[1];return{value:D[0]?D[1]:void 0,done:!0}}([D,d])}}}(this,(function(l){switch(l.label){case 0:r(this.rect),e=function(t,e){for(var i=[],o=0;o<t.length;o+=e)i.push(t.substring(o,o+e));return i}(t,this.lineWordCount),i=0,l.label=1;case 1:if(!(i<e.length))return[3,6];a=e[i],D=1,l.label=2;case 2:return D<=a.length?(m.fillStyle=o,d(a.substring(0,D),{x:this.startPosition.x,y:this.startPosition.y+(30+this.lineInterval)*i},o,"Arial",30),[4,n(20)]):[3,5];case 3:l.sent(),l.label=4;case 4:return D++,[3,2];case 5:return i++,[3,1];case 6:return[2]}}))},new((a=void 0)||(a=Promise))((function(t,o){function n(t){try{d(D.next(t))}catch(t){o(t)}}function r(t){try{d(D.throw(t))}catch(t){o(t)}}function d(e){var i;e.done?t(e.value):(i=e.value,i instanceof a?i:new a((function(t){t(i)}))).then(n,r)}d((D=D.apply(e,i||[])).next())}));var e,i,a,D},t}(),u=function(){function t(t,e,i){this.lineWidth=6,this.rect=t,this.partOfSpeech=e,this.card=i}return t.prototype.CheckIfHit=function(t){return l(t,this.rect)},t.prototype.CheckIfHitCard=function(t){return this.card},t.prototype.drawSlot=function(){r(this.rect),"動"==this.partOfSpeech?D(this.rect,i,this.lineWidth):D(this.rect,e,this.lineWidth),this.card&&this.card.drawCard()},t.prototype.AddCard=function(t){this.card=t,t.PlaceAt({x:this.rect.x+.5*(this.rect.w-t.GetRect().w),y:this.rect.y})},t.prototype.IsPartOfSpeechEqual=function(t){return this.partOfSpeech==t},t.prototype.RemoveCard=function(){var t=this.card;return this.card=null,t},t.prototype.IsCardEqual=function(t){return this.card==t},t.prototype.GetCardID=function(){return this.card?this.card.GetCardID():-1},t.prototype.HasCard=function(){return null!=this.card},t}();const C=JSON.parse('[{"ID":0,"Word":"我","PartOfSpeech":"名"},{"ID":1,"Word":"檢視","PartOfSpeech":"動"},{"ID":2,"Word":"密室","PartOfSpeech":"名"},{"ID":3,"Word":"桌子","PartOfSpeech":"名"},{"ID":4,"Word":"門","PartOfSpeech":"名"},{"ID":5,"Word":"移至","PartOfSpeech":"動"},{"ID":6,"Word":"開","PartOfSpeech":"動"},{"ID":7,"Word":"角落","PartOfSpeech":"名"},{"ID":8,"Word":"爬上","PartOfSpeech":"動"},{"ID":9,"Word":"天花板","PartOfSpeech":"名"},{"ID":10,"Word":"方塊","PartOfSpeech":"名"},{"ID":11,"Word":"問","PartOfSpeech":"動"},{"ID":12,"Word":"他","PartOfSpeech":"名"}]'),c=JSON.parse('[{"ID":0,"Dialogue":"這裡是哪裡？「我」醒了過來。發現在自己被困在一間「密室」。我摸著自己的口袋，沒有找到手機，無法對外聯繫。但發現一張藍色卡片「檢視」。這是做什麼用的？（獲得「密室」、「我」、「檢視」）"},{"ID":1,"Dialogue":"我檢視這密室。看見密室內有一扇「門」與一張「桌子」。沒有別的東西了。"},{"ID":2,"Dialogue":"我已經檢視過這密室。密室內除了一扇門與一張桌子外，沒有其他特別的東西了。"},{"ID":3,"Dialogue":"我檢視這張桌子。外觀很像开這個字。好像沒有其他值得注意的地方了。"},{"ID":4,"Dialogue":"桌子外觀很像开這個字。好像沒有其他特別的地方了。"},{"ID":5,"Dialogue":"我靠近這扇門並檢視。是一扇很大的門。我感覺整個人在門的下面。忽然間，眼前閃了一道光芒。原來人在門的下面，就成了閃字。我回想起小時候，有人曾在桌子底下寫字。"},{"ID":6,"Dialogue":"我看見桌子在大門之下，形成了「開」這個字。（獲得「開」）"},{"ID":7,"Dialogue":"桌子原本在密室的中央，我將桌子移至大門下面。"},{"ID":8,"Dialogue":"桌子已經移至大門之下了。"},{"ID":9,"Dialogue":"我開啟大門。我來到一間審訊室。眼前坐著一個高大的黑衣人。我盯著黑衣人，他一語不發，但同時我也無法和他說話。我聽見背後的大門自動關上。我被困在這裡了。（遊戲結束）"},{"ID":10,"Dialogue":"桌面是可以活動的。我將桌面掀開。看見裡面有兩張卡片，一黃一藍，「角落」、「爬上」。（獲得「角落」、「爬上」）"},{"ID":11,"Dialogue":"我檢視著密室的角落。什麼也沒有。"},{"ID":12,"Dialogue":"我將桌子移至密室的角落。"},{"ID":13,"Dialogue":"我已經將桌子移至密室角落。"},{"ID":14,"Dialogue":"我爬上桌子。我看見頭頂上就是「天花板」。（獲得「天花板」）"},{"ID":15,"Dialogue":"我爬上桌子。頭頂上是天花板。"},{"ID":16,"Dialogue":"我檢視天花板。天花板是由一塊一塊木板拼湊而成。"},{"ID":17,"Dialogue":"角落上方的天花板太高，我摸不到。"},{"ID":18,"Dialogue":"我爬上門上方的天花板。天花板上是一個很狹小的空間。我找到了一個木製的「方塊」。隨後，我下來至密室中央。（獲得「方塊」）"},{"ID":19,"Dialogue":"我檢視這方塊。方塊中間有一個貫穿方塊的方洞。沒有其他特別的地方了。方塊大概有一顆頭這麼大。"},{"ID":20,"Dialogue":"我將方塊移至大門前。"},{"ID":21,"Dialogue":"我檢視大門。方塊在大門之下形成了「問」這個字。"},{"ID":22,"Dialogue":"我開啟大門。我來到一間審訊室。眼前坐著一個高大的黑衣人。「他」盯著我看，卻不發一語。這時密室的門自動關上。我被困在這裡了。（獲得「他」）"},{"ID":23,"Dialogue":"我檢視黑衣人。穿著黑色大衣，大概有190公分高。"},{"ID":24,"Dialogue":"黑衣人似乎不聽從我的指令。"},{"ID":25,"Dialogue":"我問黑衣人：「小華在哪裡？」黑衣人眼神呆滯了一下，並回答：「吊在樹上。」"},{"ID":26,"Dialogue":"黑衣人問我：「小華是誰？」我回答：「小木屋。」這時我們相擁而泣，我找到了我的兒時玩伴。小華是我們小時候的秘密基地。沒想到會在這裡見面，是誰把我們安排在這個地方？"},{"ID":27,"Dialogue":"黑衣人爬上桌子。"},{"ID":28,"Dialogue":"黑衣人身高夠高，他將角落的天花板掀開。"},{"ID":29,"Dialogue":"黑衣人爬上角落上方的天花板。他看見上面似乎是一個通道。"},{"ID":30,"Dialogue":"黑衣人在天花板上。他拉了我一把，我成功爬上了天花板。我和他穿越通道，遠方越來越明亮。我們來到洞穴出口。遠方是一座城市。我打算通報警察這件事。（恭喜通關）"},{"ID":31,"Dialogue":"黑衣人檢視門。門在他面前就沒有顯得這麼高大。"},{"ID":32,"Dialogue":"黑衣人檢視我。他一臉難以置信，會在這個地方見到以前的朋友。"},{"ID":33,"Dialogue":"黑衣人檢視方塊。他回想起小木屋的小書櫃，裡面有許多本小說。"},{"ID":34,"Dialogue":"黑衣人檢視桌子。他回想起小木屋內也曾有一張一模一樣的桌子。"},{"ID":35,"Dialogue":"黑衣人檢視天花板。天花板由許多木板拼成，很像是小木屋的建材。"},{"ID":36,"Dialogue":"黑衣人檢視密室。他剛才似乎也被困在一間密室內，也是沒有什麼東西。"},{"ID":37,"Dialogue":"黑衣人檢視角落。他也沒看到什麼東西。"},{"ID":38,"Dialogue":"我已經開啟過桌面。在裡面發現兩張卡片「角落」、「爬上」。沒有其他東西了。"},{"ID":39,"Dialogue":"我滑開門上方的天花板，一架梯子掉了下來。"},{"ID":40,"Dialogue":"角落上方的天花板已經被掀開。"},{"ID":41,"Dialogue":"門上方的天花板已經被掀開。"},{"ID":42,"Dialogue":"黑衣人爬上門上方的天花板。除了我剛才找到的方塊，他在裡面沒有找到其他東西了。隨後，他回到了密室中央。"},{"ID":43,"Dialogue":"我檢視這扇門。是一扇很大的門。沒有其他特別的地方了。"},{"ID":44,"Dialogue":"我站在地上。天花板太高，我摸不到。"},{"ID":45,"Dialogue":"黑衣人站在地上，摸不到天花板。"},{"ID":46,"Dialogue":"門上方天花板是封閉的，我無法爬上。"},{"ID":47,"Dialogue":"我已經爬上門上方的天花板。在裡面找到一個方塊，沒有其他東西了。隨後，我下來至密室中央。"},{"ID":48,"Dialogue":"我已經將方塊移至大門前了。"},{"ID":49,"Dialogue":"我將方塊移至角落。什麼也沒發生。"},{"ID":50,"Dialogue":"我已經將方塊移至角落了。"},{"ID":51,"Dialogue":"黑衣人站了起來，走向門，掏出鑰匙將門解鎖並開啟。原來他有鑰匙！我們隨後來到了密室。"},{"ID":52,"Dialogue":"我目前沒有想問他的問題了。"},{"ID":53,"Dialogue":"黑衣人沒有想問我的問題了。"},{"ID":54,"Dialogue":"我們都被困在這間審訊室。無法回到我剛才的密室。"},{"ID":55,"Dialogue":"黑衣人已經將門開啟。"},{"ID":56,"Dialogue":"角落上方的天花板是封閉的，黑衣人無法爬上。"},{"ID":57,"Dialogue":"我檢視桌子底下，果然發現有用簽字筆寫的兩個字「移至」。（獲得「移至」）"},{"ID":58,"Dialogue":"桌子外觀很像开這個字。除了剛才發現的字跡，好像沒有其他特別的地方了。"},{"ID":59,"Dialogue":"我已經在桌上了。"},{"ID":60,"Dialogue":"黑衣人已經在桌上了。"},{"ID":61,"Dialogue":"密室的大門與審訊室共用。我看見大門在審訊室這一側有一個鑰匙孔。"},{"ID":62,"Dialogue":"黑衣人看著這扇自動關閉的門。右手插入黑色大衣的口袋，似乎在找什麼。"},{"ID":63,"Dialogue":"我嘗試從審訊室這一側開啟被鎖上的大門。我用力推大門，大門還是一動也不動。"},{"ID":64,"Dialogue":"審訊室上方的天花板是水泥做的，什麼也沒有。"},{"ID":65,"Dialogue":"黑衣人看著審訊室上方的天花板，他什麼也沒看見。"},{"ID":66,"Dialogue":"我檢視審訊室的角落。什麼也沒有。"},{"ID":67,"Dialogue":"黑衣人檢視審訊室的角落。他什麼也沒發現。"},{"ID":68,"Dialogue":"方塊沒有什麼地方是可以打開的。"},{"ID":69,"Dialogue":"黑衣人嘗試打開方塊，他沒有找到可以打開的地方。"},{"ID":70,"Dialogue":"黑衣人沒有可以打開的地方。"},{"ID":71,"Dialogue":"黑衣人嘗試打開我，我抗拒著。最終他沒有找到可以打開我的地方。"},{"ID":72,"Dialogue":"審訊室的天花板太高，也沒有洞口，我無法爬上。"},{"ID":73,"Dialogue":"黑衣人無法碰觸到審訊室的天花板。他無法爬上。"},{"ID":74,"Dialogue":"我爬上黑衣人，讓我想起以前騎馬打仗。隨後我下來到地面。"},{"ID":75,"Dialogue":"不要吧。他太重了。我會骨折。"},{"ID":76,"Dialogue":"門是平坦的。沒有地方可以讓我爬上。"},{"ID":77,"Dialogue":"黑衣人看著平坦的門。他沒有找到能夠讓他爬上的凸起物。"},{"ID":78,"Dialogue":"我大喊著：「密室啊密室！是誰把我困在這個地方？」"},{"ID":79,"Dialogue":"黑衣人不想對著空氣說話。"},{"ID":80,"Dialogue":"門已經被開啟。"}]'),h=JSON.parse('[{"CardID1":0,"CardID2":1,"CardID3":2,"Condition":"!MeInspectRoom","NewCardID":[3,4],"DialogueID":1,"Consequence":"MeInspectRoom = true;"},{"CardID1":0,"CardID2":1,"CardID3":2,"Condition":"MeInspectRoom","DialogueID":2},{"CardID1":0,"CardID2":1,"CardID3":3,"Condition":"!MeInspectTable && !MeInspectDoor","DialogueID":3,"Consequence":"MeInspectTable = true;"},{"CardID1":0,"CardID2":1,"CardID3":3,"Condition":"MeInspectTable && !MeInspectDoor","DialogueID":4},{"CardID1":0,"CardID2":1,"CardID3":3,"Condition":"MeInspectDoor && !MoveToGot","NewCardID":[5],"DialogueID":57,"Consequence":"MoveToGot = true;"},{"CardID1":0,"CardID2":1,"CardID3":3,"Condition":"MeInspectDoor && MoveToGot","DialogueID":58},{"CardID1":0,"CardID2":1,"CardID3":4,"Condition":"!MeInspectDoor","DialogueID":5,"Consequence":"MeInspectDoor = true;"},{"CardID1":0,"CardID2":1,"CardID3":4,"Condition":"TablePosition == \\"Door\\" && !OpenGot","NewCardID":[6],"DialogueID":6,"Consequence":"OpenGot = true;"},{"CardID1":0,"CardID2":1,"CardID3":4,"Condition":"CubePosition == \\"Door\\" && !AskGot","NewCardID":[11],"DialogueID":21,"Consequence":"AskGot = true;"},{"CardID1":0,"CardID2":1,"CardID3":4,"Condition":"MeInspectDoor && (TablePosition != \\"Door\\" || OpenGot) && (CubePosition != \\"Door\\" || AskGot)","DialogueID":43},{"CardID1":0,"CardID2":1,"CardID3":4,"Condition":"MePosition == \\"InterrogationRoom\\"","DialogueID":61},{"CardID1":3,"CardID2":5,"CardID3":4,"Condition":"TablePosition != \\"Door\\"","DialogueID":7,"Consequence":"TablePosition = \\"Door\\";"},{"CardID1":3,"CardID2":5,"CardID3":4,"Condition":"TablePosition == \\"Door\\"","DialogueID":8},{"CardID1":0,"CardID2":6,"CardID3":4,"Condition":"!AskGot","DialogueID":9,"Consequence":"EndState = \\"Bad\\";"},{"CardID1":0,"CardID2":6,"CardID3":4,"Condition":"AskGot && MePosition != \\"InterrogationRoom\\" && !DoorOpen","NewCardID":[12],"DialogueID":22,"Consequence":"MePosition = \\"InterrogationRoom\\";\\r\\nHeGot = true;"},{"CardID1":0,"CardID2":6,"CardID3":4,"Condition":"MePosition == \\"InterrogationRoom\\"","DialogueID":63},{"CardID1":0,"CardID2":6,"CardID3":4,"Condition":"DoorOpen","DialogueID":80},{"CardID1":0,"CardID2":6,"CardID3":3,"Condition":"!TableOpen","NewCardID":[7,8],"DialogueID":10,"Consequence":"TableOpen = true;"},{"CardID1":0,"CardID2":6,"CardID3":3,"Condition":"TableOpen","DialogueID":38},{"CardID1":3,"CardID2":5,"CardID3":7,"Condition":"TablePosition != \\"Corner\\"","DialogueID":12,"Consequence":"TablePosition = \\"Corner\\";"},{"CardID1":3,"CardID2":5,"CardID3":7,"Condition":"TablePosition == \\"Corner\\"","DialogueID":13},{"CardID1":0,"CardID2":8,"CardID3":3,"Condition":"!HasClimbTable && MePosition != \\"Table\\"","NewCardID":[9],"DialogueID":14,"Consequence":"HasClimbTable = true;\\r\\nMePosition = \\"Table\\";"},{"CardID1":0,"CardID2":8,"CardID3":3,"Condition":"HasClimbTable && MePosition != \\"Table\\"","DialogueID":15,"Consequence":"MePosition = \\"Table\\""},{"CardID1":0,"CardID2":8,"CardID3":3,"Condition":"MePosition == \\"Table\\"","DialogueID":59},{"CardID1":0,"CardID2":1,"CardID3":7,"Condition":"MePosition != \\"InterrogationRoom\\"","DialogueID":11},{"CardID1":0,"CardID2":1,"CardID3":7,"Condition":"MePosition == \\"InterrogationRoom\\"","DialogueID":66},{"CardID1":0,"CardID2":1,"CardID3":9,"Condition":"MePosition != \\"InterrogationRoom\\"","DialogueID":16,"Consequence":"MeInspectCeiling = true;"},{"CardID1":0,"CardID2":1,"CardID3":9,"Condition":"MePosition == \\"InterrogationRoom\\"","DialogueID":64},{"CardID1":0,"CardID2":6,"CardID3":9,"Condition":"MePosition != \\"Table\\"","DialogueID":44},{"CardID1":0,"CardID2":6,"CardID3":9,"Condition":"MePosition == \\"Table\\" && TablePosition == \\"Corner\\" && !CornerCeilingOpen","DialogueID":17},{"CardID1":0,"CardID2":6,"CardID3":9,"Condition":"MePosition == \\"Table\\" && TablePosition == \\"Door\\" && !DoorCeilingOpen","DialogueID":39,"Consequence":"DoorCeilingOpen = true;"},{"CardID1":0,"CardID2":6,"CardID3":9,"Condition":"MePosition == \\"Table\\" && TablePosition == \\"Corner\\" && CornerCeilingOpen","DialogueID":40},{"CardID1":0,"CardID2":6,"CardID3":9,"Condition":"MePosition == \\"Table\\" && TablePosition == \\"Door\\" && DoorCeilingOpen","DialogueID":41},{"CardID1":0,"CardID2":8,"CardID3":9,"Condition":"MePosition != \\"Table\\"","DialogueID":44},{"CardID1":0,"CardID2":8,"CardID3":9,"Condition":"MePosition == \\"Table\\" && TablePosition == \\"Corner\\" && HePosition != \\"Ceiling\\"","DialogueID":17},{"CardID1":0,"CardID2":8,"CardID3":9,"Condition":"MePosition == \\"Table\\" && TablePosition == \\"Door\\" && !DoorCeilingOpen","DialogueID":46},{"CardID1":0,"CardID2":8,"CardID3":9,"Condition":"MePosition == \\"Table\\" && TablePosition == \\"Door\\" && DoorCeilingOpen && !CubeGot","NewCardID":[10],"DialogueID":18,"Consequence":"CubeGot = true;\\r\\nMePosition = \\"Room\\";"},{"CardID1":0,"CardID2":8,"CardID3":9,"Condition":"MePosition == \\"Table\\" && TablePosition == \\"Door\\" && DoorCeilingOpen && CubeGot","DialogueID":47,"Consequence":"MePosition = \\"Room\\";"},{"CardID1":0,"CardID2":8,"CardID3":9,"Condition":"MePosition == \\"InterrogationRoom\\"","DialogueID":72},{"CardID1":0,"CardID2":8,"CardID3":9,"Condition":"MePosition == \\"Table\\" && TablePosition == \\"Corner\\" && HePosition == \\"Ceiling\\"","DialogueID":30,"Consequence":"EndState = \\"Good\\";"},{"CardID1":10,"CardID2":5,"CardID3":4,"Condition":"CubePosition != \\"Door\\"","DialogueID":20,"Consequence":"CubePosition = \\"Door\\";"},{"CardID1":10,"CardID2":5,"CardID3":4,"Condition":"CubePosition == \\"Door\\"","DialogueID":48},{"CardID1":10,"CardID2":5,"CardID3":7,"Condition":"CubePosition != \\"Corner\\"","DialogueID":49},{"CardID1":10,"CardID2":5,"CardID3":7,"Condition":"CubePosition == \\"Corner\\"","DialogueID":50},{"CardID1":0,"CardID2":1,"CardID3":10,"DialogueID":19,"Consequence":"MeInspectCube = true;"},{"CardID1":0,"CardID2":1,"CardID3":12,"DialogueID":23},{"CardID1":0,"CardID2":11,"CardID3":12,"Condition":"!MeAsked","DialogueID":25,"Consequence":"MeAsked = true;"},{"CardID1":0,"CardID2":11,"CardID3":12,"Condition":"MeAsked","DialogueID":52},{"CardID1":12,"CardID2":11,"CardID3":0,"Condition":"!MeAsked","DialogueID":24},{"CardID1":12,"CardID2":11,"CardID3":0,"Condition":"MeAsked && !HeAsked","DialogueID":26,"Consequence":"HeAsked = true;"},{"CardID1":12,"CardID2":11,"CardID3":0,"Condition":"HeAsked","DialogueID":53},{"CardID1":12,"CardID2":6,"CardID3":4,"Condition":"!DoorOpen","DialogueID":51,"Consequence":"DoorOpen = true;\\r\\nMePosition = \\"Room\\";\\r\\nHePosition = \\"Room\\";"},{"CardID1":12,"CardID2":6,"CardID3":4,"Condition":"DoorOpen","DialogueID":55},{"CardID1":12,"CardID2":8,"CardID3":3,"Condition":"HePosition != \\"Table\\"","DialogueID":27,"Consequence":"HePosition = \\"Table\\";"},{"CardID1":12,"CardID2":8,"CardID3":3,"Condition":"HePosition == \\"Table\\"","DialogueID":60},{"CardID1":12,"CardID2":6,"CardID3":9,"Condition":"HePosition == \\"Table\\" && TablePosition == \\"Corner\\" && !CornerCeilingOpen","DialogueID":28,"Consequence":"CornerCeilingOpen = true;"},{"CardID1":12,"CardID2":6,"CardID3":9,"Condition":"HePosition == \\"Table\\" && TablePosition == \\"Corner\\" && CornerCeilingOpen","DialogueID":40},{"CardID1":12,"CardID2":6,"CardID3":9,"Condition":"HePosition == \\"Table\\" && TablePosition == \\"Door\\" && DoorCeilingOpen","DialogueID":41},{"CardID1":12,"CardID2":8,"CardID3":9,"Condition":"HePosition != \\"Table\\"","DialogueID":45},{"CardID1":12,"CardID2":8,"CardID3":9,"Condition":"HePosition == \\"Table\\" && TablePosition == \\"Door\\"","DialogueID":42,"Consequence":"HePosition = \\"Room\\";"},{"CardID1":12,"CardID2":8,"CardID3":9,"Condition":"HePosition == \\"Table\\" && TablePosition == \\"Corner\\" && !CornerCeilingOpen","DialogueID":56},{"CardID1":12,"CardID2":8,"CardID3":9,"Condition":"HePosition == \\"Table\\" && TablePosition == \\"Corner\\" && CornerCeilingOpen","DialogueID":29,"Consequence":"HePosition = \\"Ceiling\\";"},{"CardID1":12,"CardID2":8,"CardID3":9,"Condition":"HePosition == \\"InterrogationRoom\\"","DialogueID":73},{"CardID1":12,"CardID2":1,"CardID3":4,"Condition":"HePosition != \\"InterrogationRoom\\"","DialogueID":31},{"CardID1":12,"CardID2":1,"CardID3":4,"Condition":"HePosition == \\"InterrogationRoom\\"","DialogueID":62},{"CardID1":12,"CardID2":1,"CardID3":0,"DialogueID":32},{"CardID1":12,"CardID2":1,"CardID3":10,"DialogueID":33},{"CardID1":12,"CardID2":1,"CardID3":3,"DialogueID":34},{"CardID1":12,"CardID2":1,"CardID3":9,"Condition":"HePosition != \\"InterrogationRoom\\"","DialogueID":35},{"CardID1":12,"CardID2":1,"CardID3":9,"Condition":"HePosition == \\"InterrogationRoom\\"","DialogueID":65},{"CardID1":12,"CardID2":1,"CardID3":2,"DialogueID":36},{"CardID1":12,"CardID2":1,"CardID3":7,"Condition":"HePosition != \\"InterrogationRoom\\"","DialogueID":37},{"CardID1":12,"CardID2":1,"CardID3":7,"Condition":"HePosition == \\"InterrogationRoom\\"","DialogueID":67},{"CardID1":0,"CardID2":6,"CardID3":10,"DialogueID":68},{"CardID1":12,"CardID2":6,"CardID3":10,"DialogueID":69},{"CardID1":0,"CardID2":6,"CardID3":12,"DialogueID":70},{"CardID1":12,"CardID2":6,"CardID3":0,"DialogueID":71},{"CardID1":0,"CardID2":8,"CardID3":12,"DialogueID":74},{"CardID1":12,"CardID2":8,"CardID3":0,"DialogueID":75},{"CardID1":0,"CardID2":8,"CardID3":4,"DialogueID":76},{"CardID1":12,"CardID2":8,"CardID3":4,"DialogueID":77},{"CardID1":0,"CardID2":11,"CardID3":2,"DialogueID":78},{"CardID1":12,"CardID2":11,"CardID3":2,"DialogueID":79}]'),g=JSON.parse('[{"CardID1":12,"CardID2":1,"Condition":"!HeAsked","FallbackDialogueID":24},{"CardID1":12,"CardID2":6,"Condition":"!HeAsked","FallbackDialogueID":24},{"CardID1":12,"CardID2":8,"Condition":"!HeAsked","FallbackDialogueID":24},{"CardID2":1,"CardID3":2,"Condition":"MePosition == \\"InterrogationRoom\\"","FallbackDialogueID":54},{"CardID2":1,"CardID3":3,"Condition":"MePosition == \\"InterrogationRoom\\"","FallbackDialogueID":54},{"CardID2":1,"CardID3":10,"Condition":"MePosition == \\"InterrogationRoom\\"","FallbackDialogueID":54},{"CardID1":3,"CardID2":5,"Condition":"MePosition == \\"InterrogationRoom\\"","FallbackDialogueID":54},{"CardID1":10,"CardID2":5,"Condition":"MePosition == \\"InterrogationRoom\\"","FallbackDialogueID":54},{"CardID2":6,"CardID3":9,"Condition":"MePosition == \\"InterrogationRoom\\"","FallbackDialogueID":54},{"CardID2":6,"CardID3":10,"Condition":"MePosition == \\"InterrogationRoom\\"","FallbackDialogueID":54},{"CardID2":8,"CardID3":3,"Condition":"MePosition == \\"InterrogationRoom\\"","FallbackDialogueID":54}]'),p=JSON.parse('[{"StateName":"MeInspectRoom","StateInit":false},{"StateName":"MeInspectTable","StateInit":false},{"StateName":"MoveToGot","StateInit":false},{"StateName":"MeInspectDoor","StateInit":false},{"StateName":"TablePosition","StateInit":"null"},{"StateName":"BoxPosition","StateInit":"null"},{"StateName":"OpenGot","StateInit":false},{"StateName":"AskGot","StateInit":false},{"StateName":"EndState","StateInit":"null"},{"StateName":"HasClimbTable","StateInit":false},{"StateName":"MePosition","StateInit":"\\"Room\\""},{"StateName":"HePosition","StateInit":"\\"InterrogationRoom\\""},{"StateName":"MeAsked","StateInit":false},{"StateName":"HeAsked","StateInit":false},{"StateName":"CornerCeilingOpen","StateInit":false},{"StateName":"DoorCeilingOpen","StateInit":false},{"StateName":"CubeGot","StateInit":false},{"StateName":"CubePosition","StateInit":"null"},{"StateName":"DoorOpen","StateInit":false},{"StateName":"TableOpen","StateInit":false},{"StateName":"MeInspectCeiling","StateInit":false},{"StateName":"HeGot","StateInit":false},{"StateName":"MeInspectCube","StateInit":false}]'),f=JSON.parse('[{"HintID":0,"Hint":"現在有「密室」、「我」、「檢視」三個詞卡。能夠組成什麼句子？","Condition":"!MeInspectRoom","NextHintID":[1]},{"HintID":1,"Hint":"密室內的東西還沒有全部檢視完。","Condition":"!MeInspectDoor","NextHintID":[2]},{"HintID":2,"Hint":"主角在檢視門時，回想到有人曾在桌子底下寫字。","Condition":"!MoveToGot","NextHintID":[3]},{"HintID":3,"Hint":"桌子形狀很像「开」字，跟什麼字可以組成另一個字？把桌子移至那裡後，再檢視一下那裡。","Condition":"!OpenGot","NextHintID":[4]},{"HintID":4,"Hint":"現在有「開」這個詞卡。試著跟其他名詞組合看看。","Condition":"!TableOpen","NextHintID":[5]},{"HintID":5,"Hint":"目前有「爬上」。試著跟其他名詞組合看看。","Condition":"!HasClimbTable","NextHintID":[6]},{"HintID":6,"Hint":"再到處檢視看看。","Condition":"!MeInspectCeiling && !DoorCeilingOpen","NextHintID":[7]},{"HintID":7,"Hint":"天花板是由木板拼湊而成。也許能夠滑開？","Condition":"!DoorCeilingOpen","NextHintID":[8]},{"HintID":8,"Hint":"門上方的天花板被掀開了。上面有什麼？","Condition":"!CubeGot","NextHintID":[9]},{"HintID":9,"Hint":"剛才獲得了方塊，檢視一下。或許有什麼靈感？","Condition":"!MeInspectCube && !AskGot","NextHintID":[10]},{"HintID":10,"Hint":"方塊的形狀很像「口」。跟什麼字組合起來會變成另一個字？把方塊移至那裡後，再檢視一下那裡。","Condition":"!AskGot","NextHintID":[11]},{"HintID":11,"Hint":"好像所有可以做的事情都做了。芝麻開門吧？","Condition":"!HeGot","NextHintID":[12]},{"HintID":12,"Hint":"主角面前有一個人。能否跟他交談一下？","Condition":"!MeAsked","NextHintID":[13]},{"HintID":13,"Hint":"主角問了他問題。他有沒有想問主角的問題？","Condition":"!HeAsked","NextHintID":[14]},{"HintID":14,"Hint":"主角開不了門。還有誰可能有辦法呢？","Condition":"!DoorOpen","NextHintID":[15]},{"HintID":15,"Hint":"現在主角旁邊有一個高大個。也許他能碰觸到那個很高的地方？","Condition":"!CornerCeilingOpen","NextHintID":[16]},{"HintID":16,"Hint":"角落上方的天花板已經被掀開。上面有什麼？角落天花板對主角而言太高，有誰比較高？","Condition":"HePosition != \\"Ceiling\\"","NextHintID":[17]},{"HintID":17,"Hint":"他在天花板上。原本主角爬不上天花板，也許現在可以倚靠他？","Condition":"MePosition != \\"Ceiling\\""}]');var y="pick up",b="put back";function H(t){return new Audio("audio/".concat(t,".wav"))}var P=function(){function t(t){this.rect={x:0,y:0,w:70*t.Word.length,h:70},this.cardInfo=t}return t.prototype.PlaceAt=function(t){this.rect.x=t.x,this.rect.y=t.y},t.prototype.IsClickable=function(){return!0},t.prototype.GetRect=function(){return this.rect},t.prototype.GetCardID=function(){return this.cardInfo.ID},t.prototype.GetPartOfSpeech=function(){return this.cardInfo.PartOfSpeech},t.prototype.drawCard=function(){"動"==this.cardInfo.PartOfSpeech?a(this.rect,i):a(this.rect,e),d(this.cardInfo.Word,{x:this.rect.x+.5*(this.rect.w-40*this.cardInfo.Word.length),y:this.rect.y+.5*(this.rect.h+40)-5},"#FFFFFF","Arial",40)},t}(),S=function(){function t(t){this.hintImageName="image/hint_icon.png",this.rect=t}return t.prototype.CheckIfHit=function(t){return l(t,this.rect)},t.prototype.Draw=function(){var t=this,e=new Image;e.src=this.hintImageName,e.addEventListener("load",(function(){m.drawImage(e,t.rect.x,t.rect.y,t.rect.w,t.rect.h)}),!1)},t}(),v=function(t,e,i,o){return new(i||(i=Promise))((function(n,r){function a(t){try{d(o.next(t))}catch(t){r(t)}}function D(t){try{d(o.throw(t))}catch(t){r(t)}}function d(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,D)}d((o=o.apply(t,e||[])).next())}))},A=function(t,e){var i,o,n,r,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:D(0),throw:D(1),return:D(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function D(D){return function(d){return function(D){if(i)throw new TypeError("Generator is already executing.");for(;r&&(r=0,D[0]&&(a=0)),a;)try{if(i=1,o&&(n=2&D[0]?o.return:D[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,D[1])).done)return n;switch(o=0,n&&(D=[2&D[0],n.value]),D[0]){case 0:case 1:n=D;break;case 4:return a.label++,{value:D[1],done:!1};case 5:a.label++,o=D[1],D=[0];continue;case 7:D=a.ops.pop(),a.trys.pop();continue;default:if(!((n=(n=a.trys).length>0&&n[n.length-1])||6!==D[0]&&2!==D[0])){a=0;continue}if(3===D[0]&&(!n||D[1]>n[0]&&D[1]<n[3])){a.label=D[1];break}if(6===D[0]&&a.label<n[1]){a.label=n[1],n=D;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(D);break}n[2]&&a.ops.pop(),a.trys.pop();continue}D=e.call(t,a)}catch(t){D=[6,t],o=0}finally{i=n=0}if(5&D[0])throw D[1];return{value:D[0]?D[1]:void 0,done:!0}}([D,d])}}},w=function(){function t(){var t=this;this.cardTable=new Map,this.dialogueTable=new Map,this.isSaying=!1,this.isTheEnd=!1,this.clickableArray=[],this.currentHintArray=[],this.currentHintIndex=0;this.slotArray=[new u({x:65,y:250,w:210,h:70},"名",null),new u({x:295,y:250,w:210,h:70},"動",null),new u({x:525,y:250,w:210,h:70},"名",null)],this.inventory=new I({x:15,y:330,w:770,h:250},10),this.clickableArray.push(this.inventory,this.slotArray[0],this.slotArray[1],this.slotArray[2]),this.typeWriter=new s({x:85,y:50,w:630,h:190},5),this.hintButton=new S({x:720,y:10,w:70,h:70}),this.clickableArray.push(this.hintButton),this.hintButton.Draw(),C.forEach((function(e){t.cardTable.set(e.ID,e)})),this.sentenceTable=h,this.fallbackTable=g,this.hintTable=new Map;for(var e=f,i=0;i<e.length;i++)this.hintTable.set(e[i].HintID,{Hint:e[i].Hint,Condition:f[i].Condition,NextHintID:e[i].NextHintID});for(this.currentHintArray.push(this.hintTable.get(0)),c.forEach((function(e){t.dialogueTable.set(e.ID,e.Dialogue)})),this.stateInitTable=p,i=0;i<this.stateInitTable.length;i++)new Function(this.stateInitTable[i].StateName+"="+this.stateInitTable[i].StateInit)();this.musicAudio=H("Depth in Ruins"),this.keybaordAudio=H("keyboard3"),this.goodEndingAudio=H("applause"),this.badEndingAudio=H("ending_bass"),this.pickupAudioArray=[H(y),H(y),H(y)],this.putbackAudioArray=[H(b),H(b),H(b)],this.musicAudio.loop=!0,this.keybaordAudio.loop=!0}return t.prototype.begin=function(){this.entrySequence()},t.prototype.entrySequence=function(){return v(this,void 0,void 0,(function(){var t;return A(this,(function(e){switch(e.label){case 0:for(t=0;t<this.slotArray.length;t++)this.slotArray[t].drawSlot();return this.inventory.drawInventory(),[4,this.SayDialogueWithoutSound(this.dialogueTable.get(0))];case 1:return e.sent(),this.inventory.AddCard(new P(this.cardTable.get(2))),this.inventory.AddCard(new P(this.cardTable.get(0))),this.inventory.AddCard(new P(this.cardTable.get(1))),this.inventory.drawInventory(),[2]}}))}))},t.prototype.onCanvasClick=function(t){var e=this;if(!this.isTheEnd&&!this.isSaying){this.musicAudio.paused&&this.musicAudio.play();for(var i=null,o=0;o<this.clickableArray.length;o++)if(this.clickableArray[o].CheckIfHit(t)){i=this.clickableArray[o];break}if(i)if(i instanceof S)this.ShowHint();else{if(i instanceof u){if(!i.HasCard())return;var n=i.RemoveCard();return this.inventory.AddCard(n),i.drawSlot(),this.inventory.drawInventory(),void this.pickupAudioArray[this.slotArray.indexOf(i)].play()}if(!this.isSlotFull()){if(i==this.inventory){if(!(n=this.inventory.CheckIfHitCard(t)))return;for(o=0;o<this.slotArray.length;o++){var r=this.slotArray[o];if(r.IsPartOfSpeechEqual(n.GetPartOfSpeech())&&r.IsCardEqual(null)){this.inventory.RemoveCard(n),r.AddCard(n),r.drawSlot(),this.inventory.drawInventory(),this.putbackAudioArray[o].play();break}}}if(this.isSlotFull()){for(o=0;o<this.fallbackTable.length;o++){var a=this.fallbackTable[o];if(this.isFallbackMatch(a)&&this.runLogicalExpression(a.Condition))return void this.SayDialogue(this.dialogueTable.get(a.FallbackDialogueID))}var D=function(t){var i=d.sentenceTable[t];return d.isSentenceMatch(i)&&d.runLogicalExpression(i.Condition)?(d.SayDialogue(d.dialogueTable.get(i.DialogueID)).then((function(){if(e.CheckNewCard(i),i.Consequence){var t;Function('"use strict";'.concat(i.Consequence))(),Function("return EndState != null")()&&(e.isTheEnd=!0,Function("return EndState == 'Good'")()?e.goodEndingAudio.play():Function("return EndState == 'Bad'")()&&e.badEndingAudio.play());do{t=[];for(var o=e.currentHintArray.length-1;o>=0;o--)e.runLogicalExpression(e.currentHintArray[o].Condition)||(t=t.concat(e.currentHintArray.splice(o,1)));for(var n=0;n<t.length;n++)if(t[n].NextHintID)for(var r=0;r<t[n].NextHintID.length;r++){var a=e.hintTable.get(t[n].NextHintID[r]);-1==e.currentHintArray.indexOf(a)&&e.currentHintArray.push(a)}}while(0!=t.length);e.currentHintIndex=0}})),"break"):"continue"},d=this;for(o=0;o<this.sentenceTable.length&&"break"!==D(o);o++);}}}}},t.prototype.ShowHint=function(){0!=this.currentHintArray.length&&(this.SayDialogue("提示：".concat(this.currentHintArray[this.currentHintIndex].Hint)),this.currentHintIndex>=this.currentHintArray.length-1?this.currentHintIndex=0:this.currentHintIndex++)},t.prototype.isSlotFull=function(){return this.slotArray[0].HasCard()&&this.slotArray[1].HasCard()&&this.slotArray[2].HasCard()},t.prototype.isSentenceMatch=function(t){return t.CardID1==this.slotArray[0].GetCardID()&&t.CardID2==this.slotArray[1].GetCardID()&&t.CardID3==this.slotArray[2].GetCardID()},t.prototype.isFallbackMatch=function(t){return!(t.CardID1&&t.CardID1!=this.slotArray[0].GetCardID()||t.CardID2&&t.CardID2!=this.slotArray[1].GetCardID()||t.CardID3&&t.CardID3!=this.slotArray[2].GetCardID())},t.prototype.SayDialogue=function(t){return v(this,void 0,void 0,(function(){return A(this,(function(e){switch(e.label){case 0:return this.isSaying=!0,this.keybaordAudio.play(),[4,this.typeWriter.say(t)];case 1:return e.sent(),this.keybaordAudio.pause(),this.isSaying=!1,[2]}}))}))},t.prototype.SayDialogueWithoutSound=function(t){return v(this,void 0,void 0,(function(){return A(this,(function(e){switch(e.label){case 0:return this.isSaying=!0,[4,this.typeWriter.say(t)];case 1:return e.sent(),this.isSaying=!1,[2]}}))}))},t.prototype.CheckNewCard=function(t){if(t.NewCardID){for(var e=0;e<t.NewCardID.length;e++){var i=this.cardTable.get(t.NewCardID[e]);this.inventory.AddCard(new P(i))}this.inventory.drawInventory()}},t.prototype.runLogicalExpression=function(t){return!t||new Function("return "+t)()},t}(),T=document.getElementById("mainCanvas"),m=T.getContext("2d");T.width=800,T.height=600,m.strokeStyle="white",m.lineWidth=1,m.strokeRect(0,0,800,600);var k=new w;T.addEventListener("click",(function(t){var e=function(t,e){var i=t.getBoundingClientRect();return{x:e.clientX-i.left,y:e.clientY-i.top}}(T,t);k.onCanvasClick(e)})),k.begin()})();