{"version":3,"file":"main.js","mappings":"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","sources":["webpack:///webpack/bootstrap","webpack:///webpack/runtime/define property getters","webpack:///webpack/runtime/hasOwnProperty shorthand","webpack:///./src/GlobalSetting.ts","webpack:///./src/TypeDefinition.ts","webpack:///./src/Utility.ts","webpack:///./src/Inventory.ts","webpack:///./src/TypeWriter.ts","webpack:///./src/Slot.ts","webpack:///./src/Level1/Level1.ts","webpack:///./src/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// 名詞顏色\nexport const noun_color = \"#FC9B45\";\n// 動詞顏色\nexport const verb_color = \"#51A6FF\";\n// 對話框的文字顏色\nexport const dialogue_color = \"#FFFFFF\";\n// 卡片欄的背景\nexport const inventory_background_color = \"#BEBEBE\";\n// 詞卡的寬度單位。詞卡有n個字，則詞卡寬度為n * card_width_unit\nexport const card_width_unit = 50;\n// 詞卡的高度\nexport const card_height = 50;\n// 對話框的文字大小\nexport const dialogue_font_size = 30;\n// 對話框的文字字體\nexport const dialogue_font = `${dialogue_font_size}px Arial`;\n// 對話框的打字間隔，單位是ms\nexport const type_interval = 20;\n// 對話框的寬度，單位是字數\nexport const dialogue_width = 20;\nexport const referenceScreenWidth: number = 800;\nexport const referenceScreenHeight: number = 600;","export interface ILevel {\n    begin(): void;\n    onCanvasClick(mousePos: Position): void;\n}\n\nexport type SentenceKey = {\n    CardID1: number;\n    CardID2: number;\n    CardID3: number;\n}\n\nexport const noun: string = \"名\";\nexport const verb: string = \"動\";\n\nexport type CardDef = {\n    ID: number;\n    Word: string;\n    PartOfSpeech: string;\n};\n\nexport type SentenceDef = {\n    CardID1: number;\n    CardID2: number;\n    CardID3: number;\n    Condition: string;\n    NewCardID: number[];\n    DialogueID: number;\n    Consequence: string;\n}\n\nexport type DialogueDef = {\n    ID: number;\n    Dialogue: string;\n};\n\nexport type FallbackDef = {\n    CardID1: number;\n    CardID2: number;\n    CardID3: number;\n    Condition: string;\n    FallbackDialogueID: number;\n};\n\nexport type Card = {\n    rect: Rect;\n    inventoryX: number;\n    inventoryY: number;\n    cardInfo: CardDef;\n    isSelected: boolean;\n}\n\nexport type Rect = {\n    x: number;\n    y: number;\n    w: number;\n    h: number;\n};\n\nexport type Position = {\n    x: number;\n    y: number;\n}","import { card_height, card_width_unit, dialogue_color, dialogue_font_size, noun_color, verb_color } from \"./GlobalSetting\";\nimport { Card, Position, Rect, verb } from \"./TypeDefinition\";\nimport { ctx } from \"./index\";\n\nexport async function sleep(ms: number): Promise<void> {\n    return new Promise(resolve => setTimeout(resolve, ms));\n}\n\nexport function clearRect(rect: Rect): void {\n    ctx.clearRect(rect.x, rect.y, rect.w, rect.h);\n}\n\nexport function drawCardFromTopLeft(card: Card): void {\n    if (card.cardInfo.PartOfSpeech == verb) {\n        ctx.fillStyle = verb_color;\n    } else {\n        ctx.fillStyle = noun_color;\n    }\n    let cardWidth = card_width_unit * card.cardInfo.Word.length;\n    ctx.fillRect(card.rect.x, card.rect.y, cardWidth, card_height);\n    ctx.fillStyle = dialogue_color;\n    ctx.fillText(card.cardInfo.Word, card.rect.x + (cardWidth - dialogue_font_size * card.cardInfo.Word.length) * .5, card.rect.y + 35);\n}\n\nexport function drawCardFromCenter(card: Card, centerX: number, centerY: number): void {\n    if (card.cardInfo.PartOfSpeech == verb) {\n        ctx.fillStyle = verb_color;\n    } else {\n        ctx.fillStyle = noun_color;\n    }\n    let cardWidth = 50 * card.cardInfo.Word.length;\n    let x = centerX - cardWidth * .5;\n    let y = centerY - card_height * .5;\n    ctx.fillRect(x, y, cardWidth, card_height);\n    ctx.fillStyle = dialogue_color;\n    ctx.fillText(card.cardInfo.Word, x + (cardWidth - dialogue_font_size * card.cardInfo.Word.length) * .5, y + 35);\n}\n\nexport function drawFilledRect(rect: Rect, color: string): void {\n    ctx.fillStyle = color;\n    ctx.fillRect(rect.x, rect.y, rect.w, rect.h);\n}\n\nexport function drawHollowRect(rect: Rect, color: string, lineWidth: number): void {\n    ctx.beginPath();\n    ctx.rect(rect.x, rect.y, rect.w, rect.h);\n    ctx.lineWidth = lineWidth;\n    ctx.strokeStyle = color;\n    ctx.stroke();\n}\n\nexport function splitString(str: string, N: number): string[] {\n    const arr = [];\n\n    for (let i = 0; i < str.length; i += N) {\n        arr.push(str.substring(i, i + N));\n    }\n\n    return arr;\n}\n\nexport function getMousePos(canvas: HTMLCanvasElement, event: MouseEvent): Position {\n    var rect = canvas.getBoundingClientRect();\n    return {\n        x: event.clientX - rect.left,\n        y: event.clientY - rect.top,\n    };\n}\n\nexport function isInside(pos: Position, rect: Rect): boolean {\n    return pos.x > rect.x && pos.x < rect.x + rect.w &&\n        pos.y < rect.y + rect.h && pos.y > rect.y;\n}\n","import { card_height, card_width_unit, inventory_background_color } from \"./GlobalSetting\";\nimport { Card, CardDef, Position, Rect } from \"./TypeDefinition\";\nimport { clearRect, drawCardFromTopLeft, drawFilledRect } from \"./Utility\";\n\nexport class Inventory {\n    public cardArray: Card[] = [];\n\n    private readonly originTail: Position = {x:110, y: 350};\n    private currentTail: Position;\n    private readonly rect: Rect = {\n        x: 100,\n        y: 340,\n        w: 600,\n        h: 220\n    };\n\n    constructor(){\n        this.currentTail = {\n            x: this.originTail.x,\n            y: this.originTail.y\n        };\n    }\n\n    public drawInventory(): void {\n        clearRect(this.rect);\n        drawFilledRect(this.rect, inventory_background_color)\n        for (let i = 0; i < this.cardArray.length; i++) {\n            if (this.cardArray[i].isSelected) continue;\n            drawCardFromTopLeft(this.cardArray[i]);\n        }\n    }\n\n    public addCard(cardInfo: CardDef): void {\n        let cardWidth = card_width_unit * cardInfo.Word.length;\n        let nextTailX = this.currentTail.x + 10 + cardWidth;\n        if (nextTailX > 700) {\n            this.currentTail.y += 10 + card_height;\n            this.currentTail.x = this.originTail.x;\n        }\n        this.cardArray.push({\n            rect: {\n                x: this.currentTail.x,\n                y: this.currentTail.y,\n                w: cardWidth,\n                h: card_height,\n            },\n            inventoryX: this.currentTail.x,\n            inventoryY: this.currentTail.y,\n            cardInfo: cardInfo,\n            isSelected: false\n        });\n        this.currentTail.x += cardWidth + 10;\n    }\n}","import { dialogue_font, dialogue_width, dialogue_color, type_interval, dialogue_font_size } from \"./GlobalSetting\";\nimport { Rect } from \"./TypeDefinition\";\nimport { clearRect, splitString, sleep } from \"./Utility\";\nimport { ctx } from \"./index\";\n\nexport class TypeWriter {\n    private rect: Rect;\n    private readonly verticalInterval: number = 5;\n\n    constructor(rect: Rect) {\n        this.rect = rect;\n    }\n\n    public async say(text: string): Promise<void> {\n        clearRect(this.rect);\n        ctx.font = dialogue_font;\n        let textSplit = splitString(text, dialogue_width);\n        for (let i = 0; i < textSplit.length; i++) {\n            let currentText = textSplit[i];\n            for (let j = 1; j <= currentText.length; j++) {\n                ctx.fillStyle = dialogue_color;\n                ctx.fillText(currentText.substring(0, j), this.rect.x,\n                    // fillText是以y的上界為底線畫文字。所以畫文字時，y要加一個dialogue_font_size\n                    this.rect.y + dialogue_font_size + (dialogue_font_size + this.verticalInterval) * i);\n                await sleep(type_interval);\n            }\n        }\n    }\n}","import { verb_color, noun_color } from \"./GlobalSetting\";\nimport { Card, Rect, verb } from \"./TypeDefinition\";\nimport { clearRect, drawCardFromCenter, drawHollowRect } from \"./Utility\";\n\nexport class Slot {\n    public rect: Rect;\n    public partOfSpeech: string;\n    private card: Card;\n    private readonly lineWidth = 6;\n\n    constructor(rect: Rect, partOfSpeech: string, card: Card) {\n        this.rect = rect;\n        this.partOfSpeech = partOfSpeech;\n        this.card = card;\n    }\n\n    public drawSlot(): void {\n        clearRect(this.rect);\n        if (this.partOfSpeech == verb) {\n            drawHollowRect(this.rect, verb_color, this.lineWidth);\n        } else {\n            drawHollowRect(this.rect, noun_color, this.lineWidth);\n        }\n        if (this.card) {\n            drawCardFromCenter(this.card, this.rect.x + this.rect.w * .5, this.rect.y + this.rect.h * .5);\n        }\n    }\n\n    public InsertCard(card: Card): void {\n        this.card = card;\n        card.isSelected = true;\n        card.rect.x = this.rect.x + (this.rect.w - card.rect.w) * .5;\n        card.rect.y = this.rect.y;\n    }\n\n    public RemoveCard(): void {\n        this.card = null;\n    }\n\n    public IsCardEqual(card: Card): boolean {\n        return this.card == card;\n    }\n\n    public GetCardID(): number {\n        if (!this.card) return -1;\n        return this.card.cardInfo.ID;\n    }\n\n    public HasCard(): boolean {\n        return this.card != null;\n    }\n}","import { Inventory } from \"../Inventory\";\nimport { TypeWriter } from \"../TypeWriter\";\nimport { CardDef, DialogueDef, FallbackDef, ILevel, Position, SentenceDef, noun, verb } from \"../TypeDefinition\";\nimport { isInside } from \"../Utility\";\nimport { Slot } from \"../Slot\";\nimport cardTableJson from './CardTable.json';\nimport dialogueTableJson from './DialogueTable.json';\nimport sentenceTableJson from './SentenceTable.json';\nimport fallbackTableJson from './FallbackTable.json';\nimport stateInitTableJson from './StateInitTable.json';\n\nexport class Level1 implements ILevel {\n    private readonly inventory: Inventory;\n    private readonly slotArray: Slot[];\n    private readonly typeWriter: TypeWriter;\n    private readonly cardTable = new Map<number, CardDef>();\n    private readonly sentenceTable: SentenceDef[];\n    private readonly fallbackTable: FallbackDef[];\n    private readonly dialogueTable = new Map<number, string>();\n    private readonly stateInitTable: { [k: string]: any }[];\n    private isSaying: boolean = false;\n    private isTheEnd: boolean = false;\n    private isMusicPlay: boolean = false;\n    private musicAudio = new Audio('audio/Depth in Ruins.wav');\n    private keybaordAudio = new Audio('audio/keyboard3.wav');\n    private goodEndingAudio = new Audio('audio/applause.wav');\n    private badEndingAudio = new Audio('audio/ending_bass.wav');\n    private pickupAudioArray: any[];\n    private putbackAudioArray: any[];\n\n    constructor() {\n        this.inventory = new Inventory();\n        this.slotArray = [\n            new Slot({ x: 145, y: 270, w: 150, h: 50, }, noun, null),\n            new Slot({ x: 325, y: 270, w: 150, h: 50 }, verb, null),\n            new Slot({ x: 505, y: 270, w: 150, h: 50 }, noun, null)\n        ];\n        this.typeWriter = new TypeWriter({ x: 100, y: 70, w: 600, h: 190 });\n\n        let cardTableRaw: CardDef[] = cardTableJson as CardDef[];\n\n        cardTableRaw.forEach(card => {\n            this.cardTable.set(card.ID, card);\n        });\n\n        this.sentenceTable = sentenceTableJson as SentenceDef[];\n        this.fallbackTable = fallbackTableJson as FallbackDef[];\n\n        let dialogueTableRaw: DialogueDef[] = dialogueTableJson as DialogueDef[];\n        dialogueTableRaw.forEach(dialogue => {\n            this.dialogueTable.set(dialogue.ID, dialogue.Dialogue);\n        });\n\n        this.stateInitTable = stateInitTableJson as { [k: string]: any }[];\n\n        for (let i = 0; i < this.stateInitTable.length; i++) {\n            new Function(this.stateInitTable[i][\"StateName\"] + \"=\" +\n                this.stateInitTable[i][\"StateInit\"])();\n        }\n\n        this.pickupAudioArray = [\n            new Audio('audio/pick up.wav'),\n            new Audio('audio/pick up.wav'),\n            new Audio('audio/pick up.wav')\n        ];\n\n        this.putbackAudioArray = [\n            new Audio('audio/put back.wav'),\n            new Audio('audio/put back.wav'),\n            new Audio('audio/put back.wav')\n        ];\n\n        this.musicAudio.loop = true;\n        this.keybaordAudio.loop = true;\n    }\n\n    public begin(): void {\n        this.entrySequence();\n    }\n\n    private async entrySequence(): Promise<void> {\n        for (let i = 0; i < this.slotArray.length; i++) {\n            this.slotArray[i].drawSlot();\n        }\n        this.inventory.drawInventory();\n        await this.typeWriter.say(this.dialogueTable.get(0));\n        this.inventory.addCard(this.cardTable.get(2));\n        this.inventory.addCard(this.cardTable.get(0));\n        this.inventory.addCard(this.cardTable.get(1));\n        this.inventory.drawInventory();\n    }\n\n    public onCanvasClick(mousePos: Position): void {\n        // 遊戲結束時阻擋點擊。\n        if (this.isTheEnd) return;\n        // 說話時不接受點擊。\n        if (this.isSaying) return;\n\n        // 檢查是否有播放BGM\n        if (!this.isMusicPlay) {\n            this.musicAudio.play();\n            this.isMusicPlay = true;\n        }\n\n        this.inventory.cardArray.forEach(card => {\n            if (!isInside(mousePos, card.rect)) return;\n            // 如果點選到的詞卡已經輸入，則把詞卡放回inventory。\n            if (card.isSelected) {\n                card.rect.x = card.inventoryX;\n                card.rect.y = card.inventoryY;\n                card.isSelected = false;\n                for (let i = 0; i < this.slotArray.length; i++) {\n                    if (this.slotArray[i].IsCardEqual(card)) {\n                        this.slotArray[i].RemoveCard();\n                        this.slotArray[i].drawSlot();\n                        this.inventory.drawInventory();\n                        this.pickupAudioArray[i].play();\n                        break;\n                    }\n                }\n                return;\n            }\n\n            // 如果輸入框已經滿了。就不再檢查造句。\n            if (this.isSlotFull()) return;\n\n            // 如果點選到的詞卡還沒有輸入，尋找一個空的slot輸入。\n            for (let i = 0; i < this.slotArray.length; i++) {\n                let slot = this.slotArray[i];\n                if (slot.partOfSpeech == card.cardInfo.PartOfSpeech) {\n                    if (slot.IsCardEqual(null)) {\n                        slot.InsertCard(card);\n                        slot.drawSlot();\n                        this.inventory.drawInventory();\n                        this.putbackAudioArray[i].play();\n                        break;\n                    }\n                }\n            }\n\n            if (!this.isSlotFull()) return;\n            // 如果三個輸入框都滿了。檢查造句。\n            // 先檢查是否滿足fallback條件\n            for (let i = 0; i < this.fallbackTable.length; i++) {\n                let fallback: FallbackDef = this.fallbackTable[i];\n                if (!this.isFallbackMatch(fallback)) continue;\n                if (!this.runLogicalExpression(fallback.Condition)) continue;\n\n                this.SayDialogue(fallback.FallbackDialogueID);\n                return;\n            }\n\n            for (let i = 0; i < this.sentenceTable.length; i++) {\n                let sentence: SentenceDef = this.sentenceTable[i];\n                if (!this.isSentenceMatch(sentence)) continue;\n                if (!this.runLogicalExpression(sentence.Condition)) continue;\n\n                this.SayDialogue(sentence.DialogueID).then(() => {\n                    this.CheckNewCard(sentence);\n                    if (sentence.Consequence) {\n                        Function(`\"use strict\";${sentence.Consequence}`)();\n                        // 檢查是否已經遊戲結束。\n                        if (Function(\"return EndState != null\")()) {\n                            this.isTheEnd = true;\n                            if (Function(\"return EndState == 'Good'\")()) {\n                                this.goodEndingAudio.play();\n                            } else if (Function(\"return EndState == 'Bad'\")()) {\n                                this.badEndingAudio.play();\n                            }\n                        }\n                    }\n                });\n                break;\n            }\n        });\n    }\n\n    private isSlotFull(): boolean {\n        return this.slotArray[0].HasCard() &&\n            this.slotArray[1].HasCard() &&\n            this.slotArray[2].HasCard();\n    }\n\n    private isSentenceMatch(sentence: { CardID1: number, CardID2: number, CardID3: number }): boolean {\n        return sentence.CardID1 == this.slotArray[0].GetCardID() &&\n            sentence.CardID2 == this.slotArray[1].GetCardID() &&\n            sentence.CardID3 == this.slotArray[2].GetCardID();\n    }\n\n    private isFallbackMatch(sentence: { CardID1: number, CardID2: number, CardID3: number }): boolean {\n        return (!sentence.CardID1 || sentence.CardID1 == this.slotArray[0].GetCardID()) &&\n            (!sentence.CardID2 || sentence.CardID2 == this.slotArray[1].GetCardID()) &&\n            (!sentence.CardID3 || sentence.CardID3 == this.slotArray[2].GetCardID());\n    }\n\n    private async SayDialogue(dialogueID: number): Promise<void> {\n        this.isSaying = true;\n        this.keybaordAudio.play();\n        await this.typeWriter.say(this.dialogueTable.get(dialogueID));\n        this.keybaordAudio.pause();\n        this.isSaying = false;\n    }\n\n    private CheckNewCard(sentenceInfo: SentenceDef): void {\n        if (sentenceInfo.NewCardID) {\n            for (let i = 0; i < sentenceInfo.NewCardID.length; i++) {\n                this.inventory.addCard(this.cardTable.get(sentenceInfo.NewCardID[i]));\n            }\n            this.inventory.drawInventory();\n        }\n    }\n\n    private runLogicalExpression(str: string): boolean {\n        if (!str) return true;\n        return new Function(\"return \" + str)();\n    }\n}","import { referenceScreenHeight, referenceScreenWidth } from \"./GlobalSetting\";\nimport { Level1 } from \"./Level1/Level1\";\nimport { ILevel, Position } from \"./TypeDefinition\";\nimport { getMousePos } from \"./Utility\";\n\nlet canvas: HTMLCanvasElement = document.getElementById(\"mainCanvas\") as HTMLCanvasElement;\nexport let ctx: CanvasRenderingContext2D = canvas.getContext(\"2d\");\n\ncanvas.width = referenceScreenWidth;\ncanvas.height = referenceScreenHeight;\nctx.strokeStyle = 'white';\nctx.lineWidth = 1;\nctx.strokeRect(0, 0, referenceScreenWidth, referenceScreenHeight);\n\nlet level: ILevel = new Level1();\n\ncanvas.addEventListener('click', (evt: MouseEvent) => {\n  let mousePos: Position = getMousePos(canvas, evt);\n  level.onCanvasClick(mousePos);\n});\n\nlevel.begin();"],"names":["__webpack_require__","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","noun_color","verb_color","dialogue_color","card_width_unit","card_height","dialogue_font_size","dialogue_font","verb","sleep","ms","Promise","resolve","setTimeout","clearRect","rect","ctx","x","y","w","h","drawCardFromTopLeft","card","cardInfo","PartOfSpeech","fillStyle","cardWidth","Word","length","fillRect","fillText","drawHollowRect","color","lineWidth","beginPath","strokeStyle","stroke","cardArray","originTail","this","currentTail","drawInventory","i","isSelected","addCard","push","inventoryX","inventoryY","verticalInterval","say","text","font","textSplit","str","N","arr","substring","splitString","currentText","j","partOfSpeech","drawSlot","centerX","centerY","drawCardFromCenter","InsertCard","RemoveCard","IsCardEqual","GetCardID","ID","HasCard","cardTable","Map","dialogueTable","isSaying","isTheEnd","isMusicPlay","musicAudio","Audio","keybaordAudio","goodEndingAudio","badEndingAudio","inventory","Inventory","slotArray","Slot","typeWriter","TypeWriter","forEach","set","sentenceTable","fallbackTable","dialogue","Dialogue","stateInitTable","Function","pickupAudioArray","putbackAudioArray","loop","begin","entrySequence","onCanvasClick","mousePos","play","pos","isSlotFull","slot","fallback","isFallbackMatch","runLogicalExpression","Condition","SayDialogue","FallbackDialogueID","sentence","isSentenceMatch","DialogueID","then","CheckNewCard","Consequence","CardID1","CardID2","CardID3","dialogueID","pause","sentenceInfo","NewCardID","canvas","document","getElementById","getContext","width","height","strokeRect","level","Level1","addEventListener","evt","event","getBoundingClientRect","clientX","left","clientY","top","getMousePos"],"sourceRoot":""}